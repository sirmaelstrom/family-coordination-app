@using MudBlazor
@using System.Security.Claims
@using FamilyCoordinationApp.Services
@inject ISiteAdminService SiteAdminService

<MudNavMenu Bordered="true" Color="Color.Primary" Class="pa-2">
    @if (IsExpanded)
    {
        <div class="app-brand mb-4 pa-3">
            <MudIcon Icon="@Icons.Material.Filled.RestaurantMenu" Size="Size.Large" Color="Color.Primary" />
            <MudText Typo="Typo.h6" Class="ml-2">Family Kitchen</MudText>
        </div>
    }
    else
    {
        <div class="app-brand-mini mb-4 pa-2 d-flex justify-center">
            <MudIcon Icon="@Icons.Material.Filled.RestaurantMenu" Size="Size.Medium" Color="Color.Primary" />
        </div>
    }
    
    <MudNavLink Href="/dashboard" Match="NavLinkMatch.All" Icon="@Icons.Material.Filled.Home">
        @if (IsExpanded) { <text>Home</text> }
    </MudNavLink>
    
    <MudNavLink Href="/recipes" Match="NavLinkMatch.Prefix" Icon="@Icons.Material.Filled.MenuBook">
        @if (IsExpanded) { <text>Recipes</text> }
    </MudNavLink>
    
    <MudNavLink Href="/meal-plan" Match="NavLinkMatch.Prefix" Icon="@Icons.Material.Filled.CalendarMonth">
        @if (IsExpanded) { <text>Meal Plan</text> }
    </MudNavLink>
    
    <MudNavLink Href="/shoppinglists" Match="NavLinkMatch.Prefix" Icon="@Icons.Material.Filled.ShoppingCart">
        @if (IsExpanded) { <text>Shopping Lists</text> }
    </MudNavLink>
    
    <MudDivider Class="my-4" />
    
    <MudNavLink Href="/settings/categories" Match="NavLinkMatch.Prefix" Icon="@Icons.Material.Filled.Settings">
        @if (IsExpanded) { <text>Settings</text> }
    </MudNavLink>
    
    <MudNavLink Href="/settings/users" Match="NavLinkMatch.Prefix" Icon="@Icons.Material.Filled.People">
        @if (IsExpanded) { <text>Family Members</text> }
    </MudNavLink>

    <MudNavLink Href="/settings/connections" Match="NavLinkMatch.Prefix" Icon="@Icons.Material.Filled.GroupAdd">
        @if (IsExpanded) { <text>Connections</text> }
    </MudNavLink>

    <MudNavLink Href="/settings/feedback" Match="NavLinkMatch.Prefix" Icon="@Icons.Material.Filled.Feedback">
        @if (IsExpanded) { <text>Feedback</text> }
    </MudNavLink>

    @if (_isSiteAdmin)
    {
        <MudDivider Class="my-2" />
        <MudText Typo="Typo.caption" Class="px-3 py-1" Color="Color.Secondary">
            @if (IsExpanded) { <text>Admin</text> }
        </MudText>
        <MudNavLink Href="/settings/households" Match="NavLinkMatch.Prefix" Icon="@Icons.Material.Filled.AdminPanelSettings">
            @if (IsExpanded) { <text>Household Requests</text> }
        </MudNavLink>
    }
</MudNavMenu>

@code {
    [Parameter]
    public bool IsExpanded { get; set; } = true;

    [CascadingParameter]
    private Task<AuthenticationState>? AuthStateTask { get; set; }

    private bool _isSiteAdmin;

    protected override async Task OnInitializedAsync()
    {
        if (AuthStateTask != null)
        {
            var authState = await AuthStateTask;
            var email = authState.User.FindFirst(ClaimTypes.Email)?.Value;
            _isSiteAdmin = SiteAdminService.IsSiteAdmin(email);
        }
    }
}

<style>
    .app-brand {
        display: flex;
        align-items: center;
        border-bottom: 1px solid var(--mud-palette-divider);
    }
    
    .app-brand-mini {
        border-bottom: 1px solid var(--mud-palette-divider);
    }
</style>
