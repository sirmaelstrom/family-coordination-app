@page "/"
@attribute [AllowAnonymous]
@using Microsoft.AspNetCore.Authorization
@inject NavigationManager Navigation
@inject AuthenticationStateProvider AuthStateProvider

<PageTitle>Family Coordination App</PageTitle>

<MudContainer MaxWidth="MaxWidth.Large" Class="py-8">
    @if (_isAuthenticated)
    {
        <!-- Redirect authenticated users to dashboard -->
        <MudText>Redirecting...</MudText>
    }
    else
    {
        <!-- Public Landing Page -->
        <div class="text-center mb-8">
            <MudIcon Icon="@Icons.Material.Filled.FamilyRestroom" 
                     Style="font-size: 5rem;" 
                     Color="Color.Primary" />
            <MudText Typo="Typo.h3" Class="mt-4 mb-2">Family Coordination App</MudText>
            <MudText Typo="Typo.h6" Color="Color.Secondary">
                Meal planning made simple for busy families
            </MudText>
        </div>

        <MudGrid Justify="Justify.Center" Class="mb-8">
            <MudItem xs="12" sm="10" md="8">
                <MudPaper Elevation="2" Class="pa-6">
                    <MudText Typo="Typo.h5" Class="mb-4">What is this?</MudText>
                    <MudText Typo="Typo.body1" Class="mb-4">
                        A collaborative meal planning app designed for families. Plan your weekly meals together, 
                        manage recipes, and automatically generate shopping lists organized by store section.
                    </MudText>
                    
                    <MudText Typo="Typo.h6" Class="mt-6 mb-3">Features</MudText>
                    <MudList T="string" Dense="true">
                        <MudListItem Icon="@Icons.Material.Filled.MenuBook">
                            <b>Recipe Management</b> — Add recipes manually or import from popular cooking sites
                        </MudListItem>
                        <MudListItem Icon="@Icons.Material.Filled.CalendarMonth">
                            <b>Meal Planning</b> — Drag-and-drop weekly meal calendar
                        </MudListItem>
                        <MudListItem Icon="@Icons.Material.Filled.ShoppingCart">
                            <b>Smart Shopping Lists</b> — Auto-generated from your meal plan, organized by aisle
                        </MudListItem>
                        <MudListItem Icon="@Icons.Material.Filled.Group">
                            <b>Family Collaboration</b> — Real-time sync so everyone stays on the same page
                        </MudListItem>
                        <MudListItem Icon="@Icons.Material.Filled.PhoneIphone">
                            <b>Mobile-Friendly</b> — Works great on your phone at the grocery store
                        </MudListItem>
                    </MudList>

                    <div class="text-center mt-6">
                        <MudButton Variant="Variant.Filled" 
                                   Color="Color.Primary" 
                                   Size="Size.Large"
                                   Href="/account/login"
                                   Class="px-8">
                            Sign In to Get Started
                        </MudButton>
                    </div>
                </MudPaper>
            </MudItem>
        </MudGrid>

        <MudText Typo="Typo.body2" Color="Color.Secondary" Align="Align.Center">
            Currently in beta testing. Built by the Heath family, for families.
        </MudText>
    }
</MudContainer>

@code {
    private bool _isAuthenticated;

    protected override async Task OnInitializedAsync()
    {
        var authState = await AuthStateProvider.GetAuthenticationStateAsync();
        _isAuthenticated = authState.User.Identity?.IsAuthenticated == true;
    }

    protected override async Task OnAfterRenderAsync(bool firstRender)
    {
        if (firstRender && _isAuthenticated)
        {
            Navigation.NavigateTo("/dashboard", forceLoad: true);
        }
    }
}
