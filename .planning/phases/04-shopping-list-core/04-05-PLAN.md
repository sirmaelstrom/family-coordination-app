---
phase: 04-shopping-list-core
plan: 05
type: execute
wave: 3
depends_on: ["04-03", "04-04"]
files_modified:
  - src/FamilyCoordinationApp/Components/Pages/ShoppingList.razor
  - src/FamilyCoordinationApp/Components/ShoppingList/ShoppingListView.razor
  - src/FamilyCoordinationApp/Components/ShoppingList/EditItemDialog.razor
  - src/FamilyCoordinationApp/Components/Layout/NavMenu.razor
autonomous: true

must_haves:
  truths:
    - "User can navigate to Shopping List page from main menu"
    - "User can generate shopping list from current week's meal plan with one click"
    - "Shopping list displays items grouped by category"
    - "User can add manual items via FAB button"
    - "User can check/uncheck items while shopping"
    - "Snackbar with undo appears when item is checked"
    - "User can edit item name, quantity, and category"
    - "User can delete items from shopping list"
    - "User can clear all checked items via menu action"
  artifacts:
    - path: "src/FamilyCoordinationApp/Components/Pages/ShoppingList.razor"
      provides: "Main shopping list page with FAB and menu"
      min_lines: 150
    - path: "src/FamilyCoordinationApp/Components/ShoppingList/ShoppingListView.razor"
      provides: "Shopping list display with category sections"
      min_lines: 60
    - path: "src/FamilyCoordinationApp/Components/ShoppingList/EditItemDialog.razor"
      provides: "Item editing dialog"
      min_lines: 80
  key_links:
    - from: "ShoppingList.razor"
      to: "IShoppingListGenerator"
      via: "injection for generation"
      pattern: "@inject.*IShoppingListGenerator"
    - from: "ShoppingList.razor"
      to: "ISnackbar"
      via: "undo snackbar on check"
      pattern: "Snackbar\\.Add.*UNDO"
    - from: "NavMenu.razor"
      to: "/shopping-list"
      via: "MudNavLink"
      pattern: "Href=\"/shopping-list\""
---

<objective>
Create the main ShoppingList page with full shopping workflow: generation, display, check-off with undo, item management, and navigation integration.

Purpose: Delivers complete shopping list functionality (SHOP-01 through SHOP-10).
Output: Fully functional shopping list page accessible from navigation menu.
</objective>

<execution_context>
@/home/[USER]/.claude/get-shit-done/workflows/execute-plan.md
@/home/[USER]/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/phases/04-shopping-list-core/04-CONTEXT.md
@src/FamilyCoordinationApp/Components/Pages/MealPlan.razor
@src/FamilyCoordinationApp/Components/Layout/NavMenu.razor
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create ShoppingListView component</name>
  <files>src/FamilyCoordinationApp/Components/ShoppingList/ShoppingListView.razor</files>
  <action>
Create ShoppingListView.razor that displays shopping list grouped by category:

1. Parameters:
   - Items: List<ShoppingListItem> (required)
   - OnItemChecked: EventCallback<ShoppingListItem>
   - OnItemEdit: EventCallback<ShoppingListItem>
   - OnItemDelete: EventCallback<ShoppingListItem>
   - OnItemsReordered: EventCallback

2. Computed properties:
   - GroupedItems: groups Items by Category, ordered by category order (Produce, Bakery, Meat, Dairy, Frozen, Pantry, Spices)
   - GetCategoryOrder: returns int for sort ordering

3. Render:
   - For each category group, render CategorySection with:
     * Category = group.Key
     * Items = group.ToList()
     * Event callbacks wired to parent

4. Empty state:
   - If Items is empty, show MudAlert with "No items in shopping list" message
  </action>
  <verify>
Build succeeds:
```bash
cd /home/[USER]/projects/github/family-coordination-app
dotnet build src/FamilyCoordinationApp
```
  </verify>
  <done>
ShoppingListView displays items grouped by category using CategorySection components.
  </done>
</task>

<task type="auto">
  <name>Task 2: Create EditItemDialog component</name>
  <files>src/FamilyCoordinationApp/Components/ShoppingList/EditItemDialog.razor</files>
  <action>
Create EditItemDialog.razor for editing existing shopping list items:

1. Parameters (via DialogParameters):
   - Item: ShoppingListItem (the item to edit)

2. State:
   - _name: string (initialized from Item.Name)
   - _quantity: decimal? (from Item.Quantity)
   - _unit: string? (from Item.Unit)
   - _category: string (from Item.Category)
   - _isSubmitting: bool

3. Categories array (same as AddItemDialog):
   - { "Meat", "Produce", "Dairy", "Pantry", "Spices", "Bakery", "Frozen" }

4. Form fields:
   - MudTextField for name (required)
   - MudNumericField for quantity (optional)
   - MudAutocomplete for unit (common units list)
   - MudSelect for category

5. Submit:
   - Validate _name not empty
   - Create updated ShoppingListItem copying IDs from original:
     * HouseholdId, ShoppingListId, ItemId from Item
     * Name = _name.Trim()
     * Quantity = _quantity
     * Unit = _unit
     * Category = _category
     * IsChecked, CheckedAt, AddedAt, etc. preserved from original
   - If quantity changed from original, calculate QuantityDelta
   - MudDialog.Close(DialogResult.Ok(updatedItem))

6. DialogActions:
   - Cancel button
   - Save button (disabled when _name empty or _isSubmitting)
  </action>
  <verify>
Build succeeds:
```bash
cd /home/[USER]/projects/github/family-coordination-app
dotnet build src/FamilyCoordinationApp
```
  </verify>
  <done>
EditItemDialog allows editing item name, quantity, unit, and category.
  </done>
</task>

<task type="auto">
  <name>Task 3: Create main ShoppingList page with full workflow</name>
  <files>src/FamilyCoordinationApp/Components/Pages/ShoppingList.razor</files>
  <action>
Create ShoppingList.razor page at /shopping-list route:

1. Page setup:
   - @page "/shopping-list"
   - @attribute [Authorize]
   - @implements IAsyncDisposable

2. Inject:
   - IShoppingListService, IShoppingListGenerator, IMealPlanService
   - ISnackbar, IDialogService
   - AuthenticationStateProvider, IDbContextFactory

3. State:
   - _householdId: int
   - _currentList: ShoppingList?
   - _activeLists: List<ShoppingList>
   - _isLoading: bool
   - _isGenerating: bool

4. Page layout:
   - MudContainer with MaxWidth.Medium
   - Header with:
     * Title "Shopping List"
     * List selector dropdown (if multiple lists)
     * Menu button (MudMenu) with actions:
       - "Generate from Meal Plan" (if no list or refresh)
       - "Clear Checked Items"
       - "Archive List"
   - ShoppingListView with current list items
   - FAB in bottom-right for adding items

5. OnInitializedAsync:
   - Get householdId from authenticated user
   - Load active shopping lists via GetActiveShoppingListsAsync
   - If lists exist, select most recent
   - Else show empty state with "Generate from Meal Plan" button

6. GenerateFromMealPlan method:
   - Set _isGenerating = true
   - Get current week's meal plan via IMealPlanService.GetOrCreateMealPlanAsync
   - Call IShoppingListGenerator.GenerateFromMealPlanAsync
   - Reload list
   - Show success snackbar

7. HandleItemChecked method:
   - Toggle item IsChecked
   - Set CheckedAt
   - Call IShoppingListService.UpdateItemAsync
   - Show snackbar with UNDO action:
     * Capture item in closure (not shared field - see RESEARCH.md pitfall)
     * config.Action = "UNDO"
     * config.VisibleStateDuration = 4000
     * config.OnClick unchecks item

8. HandleItemEdit method:
   - Open EditItemDialog with item
   - If result OK, call UpdateItemAsync
   - Reload list

9. HandleItemDelete method:
   - Show confirm dialog
   - If confirmed, call DeleteItemAsync
   - Reload list

10. HandleAddItem method (FAB click):
    - Open AddItemDialog
    - If result OK, reload list

11. ClearCheckedItems method:
    - Call ClearCheckedItemsAsync
    - Show snackbar with count deleted

12. IAsyncDisposable implementation:
    - Dispose any DbContext if held
  </action>
  <verify>
Build succeeds:
```bash
cd /home/[USER]/projects/github/family-coordination-app
dotnet build src/FamilyCoordinationApp
```
  </verify>
  <done>
ShoppingList page implements full shopping workflow with generation, check-off, undo, and item management.
  </done>
</task>

<task type="auto">
  <name>Task 4: Add navigation link to NavMenu</name>
  <files>src/FamilyCoordinationApp/Components/Layout/NavMenu.razor</files>
  <action>
Add Shopping List link to NavMenu.razor:

1. Add MudNavLink after Meal Plan link:
```razor
<MudNavLink Href="/shopping-list" Match="NavLinkMatch.Prefix" Icon="@Icons.Material.Filled.ShoppingCart">
    Shopping List
</MudNavLink>
```

2. Place it in logical order: Recipes, Meal Plan, Shopping List, Settings
  </action>
  <verify>
Build succeeds and navigation visible:
```bash
cd /home/[USER]/projects/github/family-coordination-app
dotnet build src/FamilyCoordinationApp
```
  </verify>
  <done>
Shopping List link appears in navigation menu.
  </done>
</task>

</tasks>

<verification>
Full build and run:
```bash
cd /home/[USER]/projects/github/family-coordination-app
dotnet build src/FamilyCoordinationApp
```

All components compile and page is routable.
</verification>

<success_criteria>
- ShoppingList page accessible at /shopping-list
- Navigation link appears in menu
- User can generate shopping list from meal plan
- Items display grouped by category
- Check-off works with snackbar undo
- FAB opens add item dialog
- Edit and delete work for items
- Clear checked items removes all checked
- Proper loading states shown
</success_criteria>

<output>
After completion, create `.planning/phases/04-shopping-list-core/04-05-SUMMARY.md`
</output>
