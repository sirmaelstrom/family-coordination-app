---
phase: 07-mobile-ux-polish
plan: 04
type: execute
wave: 2
depends_on: []
files_modified:
  - Services/PollingService.cs
  - Components/Shared/SyncStatusIndicator.razor
  - Components/Layout/MainLayout.razor
autonomous: true

must_haves:
  truths:
    - "Sync status indicator shows connection state"
    - "Indicator is visible in header"
    - "States: synced, syncing, offline/error"
    - "Non-intrusive during normal operation"
  artifacts:
    - Components/Shared/SyncStatusIndicator.razor
  key_links: []
---

<objective>
Add sync status indicator to header showing connection state (synced, syncing, offline/error).

Purpose: Give users confidence their changes saved, especially on spotty grocery store WiFi.
Output: Header indicator showing real-time sync status.
</objective>

<execution_context>
@/home/sirm/.claude/get-shit-done/workflows/execute-plan.md
@/home/sirm/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/phases/07-mobile-ux-polish/07-CONTEXT.md
@.planning/phases/07-mobile-ux-polish/07-RESEARCH.md
@src/FamilyCoordinationApp/Services/PollingService.cs
</context>

<tasks>

<task type="auto">
  <name>Extend PollingService with status</name>
  <files>src/FamilyCoordinationApp/Services/PollingService.cs</files>
  <action>
    Add sync status tracking to PollingService:
    ```csharp
    public enum SyncStatus { Synced, Syncing, Offline, Error }
    
    public class PollingService
    {
        public SyncStatus Status { get; private set; } = SyncStatus.Synced;
        public DateTime? LastSyncTime { get; private set; }
        public string? LastError { get; private set; }
        public event Action? OnStatusChanged;
        
        // Update status during poll cycle:
        // - Set Syncing before API call
        // - Set Synced on success
        // - Set Error on failure with LastError message
        // - Set Offline if no network (catch HttpRequestException)
    }
    ```
    
    Invoke OnStatusChanged when status changes.
  </action>
  <verify>PollingService exposes Status property and event</verify>
  <done>Sync status tracking added to PollingService</done>
</task>

<task type="auto">
  <name>Create SyncStatusIndicator component</name>
  <files>src/FamilyCoordinationApp/Components/Shared/SyncStatusIndicator.razor</files>
  <action>
    Create component that displays sync status:
    ```razor
    @inject PollingService PollingService
    @implements IDisposable
    
    <div class="sync-indicator" title="@StatusText">
        @switch (PollingService.Status)
        {
            case SyncStatus.Synced:
                <MudIcon Icon="@Icons.Material.Filled.CloudDone" 
                         Color="Color.Success" Size="Size.Small" />
                break;
            case SyncStatus.Syncing:
                <MudProgressCircular Size="Size.Small" Indeterminate="true" />
                break;
            case SyncStatus.Offline:
            case SyncStatus.Error:
                <MudIcon Icon="@Icons.Material.Filled.CloudOff" 
                         Color="Color.Warning" Size="Size.Small" />
                break;
        }
    </div>
    ```
    
    Subscribe to PollingService.OnStatusChanged and call StateHasChanged.
    Show tooltip with last sync time or error message.
  </action>
  <verify>Component renders different icons for each state</verify>
  <done>SyncStatusIndicator component created</done>
</task>

<task type="auto">
  <name>Add indicator to MainLayout</name>
  <files>src/FamilyCoordinationApp/Components/Layout/MainLayout.razor</files>
  <action>
    Add SyncStatusIndicator to the header/app bar area:
    - Position near presence indicators (online users)
    - Keep it subtle but visible
    
    ```razor
    <MudAppBar>
        <!-- existing content -->
        <MudSpacer />
        <SyncStatusIndicator />
        <PresenceIndicator />
        <UserMenu />
    </MudAppBar>
    ```
  </action>
  <verify>Sync indicator visible in app header</verify>
  <done>Indicator integrated into layout</done>
</task>

<task type="auto">
  <name>Add offline banner</name>
  <files>src/FamilyCoordinationApp/Components/Layout/MainLayout.razor</files>
  <action>
    When status is Offline or Error, show a dismissible banner:
    ```razor
    @if (PollingService.Status == SyncStatus.Offline)
    {
        <MudAlert Severity="Severity.Warning" Dense="true">
            You're offline. Changes may not sync until connection is restored.
        </MudAlert>
    }
    @else if (PollingService.Status == SyncStatus.Error)
    {
        <MudAlert Severity="Severity.Error" Dense="true">
            Sync error: @PollingService.LastError
            <MudButton OnClick="RetrySync" Size="Size.Small">Retry</MudButton>
        </MudAlert>
    }
    ```
  </action>
  <verify>Banner appears when offline or error</verify>
  <done>Offline banner implemented</done>
</task>

</tasks>

<verification>
1. Run app normally — should show green cloud/checkmark
2. Simulate slow network — should briefly show spinner during sync
3. Disable network in DevTools — should show warning icon and banner
4. Re-enable network — should recover to synced state
</verification>

<success_criteria>
- Synced state shows subtle success indicator
- Syncing state shows brief spinner (not flashy)
- Offline/error state shows warning with actionable message
- Status updates don't cause layout shift
</success_criteria>

<output>
After completion, create `.planning/phases/07-mobile-ux-polish/07-04-SUMMARY.md`
</output>
