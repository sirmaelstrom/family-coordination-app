@using FamilyCoordinationApp.Data.Entities

<MudPaper Class="mb-4" Elevation="2">
    <div class="category-header" @onclick="ToggleExpanded">
        <MudText Typo="Typo.h6">@Category</MudText>
        <div class="d-flex align-center gap-2">
            <MudChip T="string" Size="Size.Small" Color="Color.Default" Text="@GetUncheckedCount().ToString()" />
            <MudIcon Icon="@GetExpandIcon()" Size="Size.Small" />
        </div>
    </div>

    @if (_expanded)
    {
        <MudDropZone T="ShoppingListItem"
                     Identifier="@Category"
                     Class="category-body drop-zone"
                     CanDropClass="drop-zone-active"
                     AllowReorder="true">
        </MudDropZone>
    }
</MudPaper>

@code {
    [Parameter] public string Category { get; set; } = default!;
    [Parameter] public List<ShoppingListItem> Items { get; set; } = new();
    [Parameter] public EventCallback<ShoppingListItem> OnItemChecked { get; set; }
    [Parameter] public EventCallback<ShoppingListItem> OnItemEdit { get; set; }
    [Parameter] public EventCallback<ShoppingListItem> OnItemDelete { get; set; }

    private bool _expanded = true;

    private void ToggleExpanded()
    {
        _expanded = !_expanded;
    }

    private string GetExpandIcon()
    {
        return _expanded ? Icons.Material.Filled.ExpandLess : Icons.Material.Filled.ExpandMore;
    }

    private int GetUncheckedCount()
    {
        return Items.Count(i => !i.IsChecked);
    }
}

<style>
    .category-header {
        display: flex;
        justify-content: space-between;
        align-items: center;
        padding: 16px;
        min-height: 56px;
        cursor: pointer;
        transition: background-color 0.2s;
        -webkit-tap-highlight-color: transparent;
    }

    .category-header:hover {
        background-color: var(--mud-palette-action-default-hover);
    }

    .category-body {
        padding-bottom: 8px;
        min-height: 48px;
    }

    .drop-zone {
        transition: background-color 0.2s, border-color 0.2s;
    }

    .drop-zone-active {
        background-color: var(--mud-palette-primary-lighten);
        border: 2px dashed var(--mud-palette-primary);
    }
</style>
