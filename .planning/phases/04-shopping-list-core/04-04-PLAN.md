---
phase: 04-shopping-list-core
plan: 04
type: execute
wave: 2
depends_on: ["04-02"]
files_modified:
  - src/FamilyCoordinationApp/Components/ShoppingList/ShoppingListItemRow.razor
  - src/FamilyCoordinationApp/Components/ShoppingList/CategorySection.razor
  - src/FamilyCoordinationApp/Components/ShoppingList/AddItemDialog.razor
autonomous: true

must_haves:
  truths:
    - "ShoppingListItemRow displays item name, quantity, unit, and source recipes"
    - "Tapping anywhere on item row toggles checked state"
    - "Checked items appear grayed with strikethrough"
    - "Edit and delete actions are accessible via hover buttons"
    - "CategorySection groups items by category with collapsible header"
    - "CategorySection supports drag-drop reordering via blazor-dragdrop"
    - "AddItemDialog provides autocomplete for item names from history"
  artifacts:
    - path: "src/FamilyCoordinationApp/Components/ShoppingList/ShoppingListItemRow.razor"
      provides: "Individual shopping list item display with check-off"
      min_lines: 60
    - path: "src/FamilyCoordinationApp/Components/ShoppingList/CategorySection.razor"
      provides: "Category grouping with drag-drop reordering"
      min_lines: 50
    - path: "src/FamilyCoordinationApp/Components/ShoppingList/AddItemDialog.razor"
      provides: "Manual item entry dialog with autocomplete"
      min_lines: 80
  key_links:
    - from: "ShoppingListItemRow"
      to: "parent component"
      via: "EventCallback<ShoppingListItem>"
      pattern: "OnChecked\\.InvokeAsync"
    - from: "CategorySection"
      to: "blazor-dragdrop Dropzone"
      via: "Dropzone component with Items"
      pattern: "<Dropzone"
    - from: "AddItemDialog"
      to: "IShoppingListService"
      via: "injection for autocomplete"
      pattern: "@inject.*IShoppingListService"
---

<objective>
Create reusable UI components for shopping list display: item row with check-off, category section with drag-drop, and add item dialog with autocomplete.

Purpose: Building blocks for shopping list page (SHOP-03 through SHOP-10).
Output: Three reusable components ready for integration in shopping list page.
</objective>

<execution_context>
@/home/[USER]/.claude/get-shit-done/workflows/execute-plan.md
@/home/[USER]/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/phases/04-shopping-list-core/04-RESEARCH.md
@src/FamilyCoordinationApp/Components/Recipes/IngredientEntry.razor
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create ShoppingListItemRow component</name>
  <files>src/FamilyCoordinationApp/Components/ShoppingList/ShoppingListItemRow.razor</files>
  <action>
Create ShoppingListItemRow.razor in Components/ShoppingList/ folder:

1. Component structure:
   - Outer div with min-height: 48px for touch target
   - Drag handle icon (MudIcon DragIndicator) on left
   - Checkbox (MudCheckbox) bound to IsChecked
   - Content area:
     * Quantity + Unit (bold) + Name
     * Source recipes caption (if present)
   - Action buttons (edit, delete) with hover visibility

2. Parameters:
   - Item: ShoppingListItem (required)
   - OnChecked: EventCallback (when item checked/unchecked)
   - OnEdit: EventCallback (when edit button clicked)
   - OnDelete: EventCallback (when delete button clicked)

3. Behavior:
   - @onclick on entire row calls HandleClick -> toggles checked
   - @onclick:stopPropagation on checkbox, edit, delete buttons
   - Visual states:
     * Unchecked: normal appearance
     * Checked: opacity 0.6, text strikethrough
   - Hover reveals edit/delete buttons (CSS transition)

4. Quantity formatting:
   - Use Fractions library to display "1/2" instead of "0.5"
   - Import Fractions namespace

5. CSS (scoped or inline):
   - .shopping-list-item: flex, align-items center, gap 12px, padding 12px, border-bottom
   - .shopping-list-item:hover: background-color hover state
   - .drag-handle: cursor grab, secondary color
   - .item-content: flex 1, min-width 0 (for truncation)
   - .item-actions: flex, gap 4px, opacity 0, transition opacity 0.2s
   - .shopping-list-item:hover .item-actions: opacity 1
   - .item-checked: opacity 0.6
   - .quantity: font-weight 600, margin-right 8px
  </action>
  <verify>
Build succeeds:
```bash
cd /home/[USER]/projects/github/family-coordination-app
dotnet build src/FamilyCoordinationApp
```
  </verify>
  <done>
ShoppingListItemRow component displays item with check-off, edit, and delete actions.
  </done>
</task>

<task type="auto">
  <name>Task 2: Create CategorySection component with drag-drop</name>
  <files>src/FamilyCoordinationApp/Components/ShoppingList/CategorySection.razor</files>
  <action>
Create CategorySection.razor for grouping items by category with drag-drop reordering:

1. Component structure:
   - MudPaper container with elevation
   - Header: category name (MudText h6) + item count chip + expand/collapse icon
   - Collapsible body with Dropzone from blazor-dragdrop
   - ShoppingListItemRow for each item in Items list

2. Parameters:
   - Category: string (required)
   - Items: List<ShoppingListItem> (required)
   - OnReorder: EventCallback (when items reordered)
   - OnItemChecked: EventCallback<ShoppingListItem> (when item checked)
   - OnItemEdit: EventCallback<ShoppingListItem> (when item edit clicked)
   - OnItemDelete: EventCallback<ShoppingListItem> (when item delete clicked)

3. State:
   - _expanded: bool = true (default expanded)

4. Behavior:
   - Click header toggles _expanded
   - Item count chip shows unchecked item count
   - Dropzone with InstantReplace="true" for immediate visual feedback
   - AllowsDrag returns false for checked items (can't drag checked items)
   - OnItemDrop updates SortOrder for all items in category

5. Using statements:
   - @using Plk.Blazor.DragDrop

6. CSS:
   - .category-header: flex, justify-content space-between, align-items center, padding 12px, cursor pointer
   - .category-header:hover: background hover color
  </action>
  <verify>
Build succeeds:
```bash
cd /home/[USER]/projects/github/family-coordination-app
dotnet build src/FamilyCoordinationApp
```
  </verify>
  <done>
CategorySection component groups items by category with drag-drop reordering support.
  </done>
</task>

<task type="auto">
  <name>Task 3: Create AddItemDialog component with autocomplete</name>
  <files>src/FamilyCoordinationApp/Components/ShoppingList/AddItemDialog.razor</files>
  <action>
Create AddItemDialog.razor for adding manual items to shopping list:

1. Component structure:
   - MudDialog with DialogContent and DialogActions
   - MudAutocomplete for item name (SearchFunc calls service)
   - MudGrid with quantity (MudNumericField) and unit (MudAutocomplete)
   - MudSelect for category selection

2. Parameters (via DialogParameters):
   - HouseholdId: int
   - ShoppingListId: int

3. Inject:
   - IShoppingListService (for autocomplete)
   - ISnackbar (for error feedback)

4. State:
   - _itemName: string
   - _quantity: decimal?
   - _unit: string?
   - _category: string = "Pantry"
   - _isSubmitting: bool

5. Categories array:
   - { "Meat", "Produce", "Dairy", "Pantry", "Spices", "Bakery", "Frozen" }

6. SearchItemHistory method:
   - Takes string value and CancellationToken
   - Returns empty if value < 2 chars
   - Calls _shoppingListService.GetItemNameSuggestionsAsync(HouseholdId, value)
   - DebounceInterval="300" on MudAutocomplete

7. SearchUnits method:
   - Returns common units: cup, tbsp, tsp, oz, lb, g, kg, piece, can, bunch
   - Filters by StartsWith if value provided

8. Submit method:
   - Validate _itemName not empty
   - Set _isSubmitting = true
   - Create ShoppingListItem with:
     * HouseholdId, ShoppingListId from parameters
     * Name = _itemName.Trim()
     * Quantity = _quantity
     * Unit = _unit
     * Category = _category
     * IsManuallyAdded = true
     * AddedAt = DateTime.UtcNow
   - Call _shoppingListService.AddManualItemAsync
   - MudDialog.Close(DialogResult.Ok(item))

9. DialogActions:
   - Cancel button: MudDialog.Cancel()
   - Add button: disabled when _itemName empty or _isSubmitting, calls Submit

10. Options when opening:
    - CloseOnEscapeKey = true
    - AutoFocus = true on name field
  </action>
  <verify>
Build succeeds:
```bash
cd /home/[USER]/projects/github/family-coordination-app
dotnet build src/FamilyCoordinationApp
```
  </verify>
  <done>
AddItemDialog provides manual item entry with autocomplete from shopping history.
  </done>
</task>

</tasks>

<verification>
All components build:
```bash
cd /home/[USER]/projects/github/family-coordination-app
dotnet build src/FamilyCoordinationApp
```
</verification>

<success_criteria>
- ShoppingListItemRow displays item with quantity, name, source recipes
- Tapping row toggles checked state
- Checked items visually distinguished (strikethrough, opacity)
- CategorySection groups items with collapsible header
- Drag-drop reordering works within category
- AddItemDialog provides autocomplete for item names
- All three components build without errors
</success_criteria>

<output>
After completion, create `.planning/phases/04-shopping-list-core/04-04-SUMMARY.md`
</output>
